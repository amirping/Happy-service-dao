const cryptage_engine=require("../js/cryptage"),User=require("../models/user").User,Connection=require("../models/connection").Connection,crypto=require("crypto");module.exports={getUser:function(e,o){},updateUser:function(e,o){},postUser:function(e,o){e.body;let n=e.body.pseudo,s=e.body.pass;s=cryptage_engine.encrypt(s),User.findOne({pseudo:n,password:s},"name last_name",function(e,s){if(e)throw console.log(e),e;if(null==s)console.log("Login attempt for user name => "+n+" but not existe "),o.status(200).json({ok:!1,msg:"wrong pseudo or password"});else{console.log("%s %s is here .",s.name,s.last_name);let e=crypto.randomBytes(64).toString("hex");new Connection({id_user:s._id,session_token:e}).save(function(n,s){if(n)throw console.log("Error on save!"),n;o.status(200).json({ok:!0,token:e,created_at:s.create_date})})}})}};